---
id: interview-network

title: Interview Network
---

# HTTP

## HTTP 状态码

- 1xx：信息性状态码（Informational），表示请求已被接受，正在处理。
- 2xx：成功状态码（Success），表示请求正常处理完毕。
- 3xx：重定向状态码（Redirection），表示需要进行附加操作以完成请求。
- 4xx：客户端错误状态码（Client Error），表示服务器无法处理请求。
- 5xx：服务器错误状态码（Server Error），表示服务器处理请求出错。

200 OK：表示客户端的请求已被服务端正常处理。

204 No Content：表示客户端的请求已被服务端正常处理，但没有返回的内容，响应报文中不包含实体的主体部分。一般在只需要客户端往服务端发送信息，而不需要服务端返回信息的情况下使用。

206 Partial Content：表示客户端进行了范围请求，服务端成功执行了这部分的 GET 请求。响应报文中包含由 Content-Range 指定范围的实体内容。

# HTTPS

## TLS/SSL

HTTPS 实际上是在 HTTP 和 TCP 之间加入了一个安全层，这个安全层就是 TLS/SSL 协议。TLS/SSL 的功能实现主要依赖于三类基本算法：散列函数（Hash）、对称加密、非对称加密。

## HTTPS 通信过程

1. 客户端向服务端发起 HTTPS 请求，连接到服务端的 443 端口。请求中包含使用的协议版本、支持的加密算法等，并生成一个随机数发送给服务端。
2. 服务端收到请求后，确认双方使用的加密算法，返回服务端的数字证书，并生成一个随机数发送给客户端。
3. 客户端收到服务端的数字证书后，首先验证证书的有效性。然后再次生成一个随机数，使用数字证书中的公钥对其加密，发送给服务端。这个过程还会对之前的所有信息进行摘要计算，生成一个信息摘要，提供给服务端验证。
4. 服务端使用私钥解密客户端发送的随机数。此时，双方都有了三个随机数，可以使用这三个随机数以及之前约定的加密算法生成对称密钥。后续的通信双方都使用这个对称密钥进行加解密。

## HTTPS 协议如何保证安全性

因为 HTTP 协议是明文传输的，明文数据会经过中间代理服务端、路由器、WIFI 热点、通信服务运营商等多个物理节点，数据在传输过程中可能别窃取、篡改。所以需要对传输的数据进行加密。

对称加密：通信双方使用相同的密钥进行加解密，加解密速度快，但是密钥传输过程不安全。

非对称加密：通信双方使用不同的密钥进行加解密。用私钥加密的信息只能用公钥解密，用公钥加密的信息只能用私钥解密。非对称加密安全性更高，但加解密速度很慢，并且也无法保证公钥传输的安全性。

为了兼顾安全性和效率，可以结合两种加密方式，服务端将公钥明文发送给客户端，客户端生成对称加密的密钥，使用公钥加密后发送给服务端，服务端使用私钥解密得到对称加密的密钥，后续通信双方使用对称加密的密钥进行加解密。

上面这种方式的漏洞在于，如果中间人截取到服务端发送给客户端的公钥，然后伪造一个公钥发送给客户端，客户端使用伪造的公钥加密信息发送给服务端，中间人可以使用自己的私钥解密信息，然后再使用服务端的公钥加密信息发送给服务端。这样中间人就获取了双方通信的对称密钥。这个漏洞的根本在于客户端无法保证获取到的公钥的真实性。

因此，需要可信赖的第三方证书颁发机构（CA，Certificate Authority）来签发数字证书。数字证书中包含了证书持有者信息、公钥信息等。服务端将数字证书发送给客户端，客户端能够从数字证书中获取到服务端的公钥。

数字证书由明文数据和数字签名组成。数字证书传输的安全性是通过数字签名的机制来保证的。CA 机构对证书明文数据进行哈希计算，得到证书信息摘要。然后 CA 机构使用自己的私钥对证书信息摘要进行加密，得到数字签名。

由于 CA 是客户端信任的机构，因此客户端保存了 CA 机构的公钥。客户端收到数字证书后，使用 CA 机构的公钥解密数字签名，得到证书信息摘要。然后客户端用证书里指明的哈希算法对证书明文数据进行哈希计算，与解密得到的信息摘要进行比对。如果两者一致，表明数字证书没有被篡改。

## 中间人攻击可以篡改或替换数字证书吗

假设中间人篡改了证书的明文数据，由于他没有 CA 机构的私钥，因此无法生成正确的数字签名。客户端使用 CA 机构的公钥解密数字签名时，会得到错误的信息摘要，与自己计算的信息摘要不一致。

假设中间人也获得了同一家 CA 机构颁发的数字证书，并且在进行中间人攻击时用自己的证书替换了服务端的证书。客户端收到服务端的数字证书后，会发现数字证书上的网站信息与自己实际访问的网站信息不一致。

## 为什么生成数字签名时要先进行哈希计算

非对称加密通常比哈希算法要慢得多，因为它需要进行复杂的数学运算。通过先对数据进行哈希处理，可以生成一个相对较小的摘要，然后对这个摘要进行非对称加密，从而提高整个签名过程的效率。

## 证书链

- 根证书：数字证书链的起点是根证书，这是一个自签名的证书，通常由 CA 自己签发。根证书是信任的基石，因为它是不需要其他证书来验证的。操作系统、浏览器本身会预装一些信任的 CA 机构的根证书。
- 中间证书：在根证书和最终用户证书之间，可能存在一个或多个中间证书。这些中间证书由根证书签发，用于减少根 CA 的负担，同时提供更细粒度的管理和撤销机制。
- 最终用户证书：这是数字证书链的终点，通常是为特定的个人、组织或服务器签发的证书。这个证书包含了公钥和证书持有者的身份信息，由中间 CA 或根 CA 签发。
- 证书签名：每个证书都使用前一个证书中的公钥进行签名，直到根证书。这种签名机制确保了证书链的完整性和可信性。

## 每次 HTTPS 请求都需要重新建立 TLS/SSL 连接吗

服务端会为每个客户端维护一个 Session ID，在 TLS/SSL 握手阶段传递给客户端。客户端生成好密钥传给服务器后，服务器会把该密钥存到相应的上下文中。之后的请求，客户端只需要带上 Session ID，服务端就可以找到相应的密钥。

## HTTPS 的特点

优点：

- 加密传输，防止数据被窃取、篡改，安全性。
- 大幅增加了中间人攻击的成本。

缺点：

- 加密、解密过程增加了计算量，更加耗费资源。
- 协议握手阶段更加耗时。
- 服务端资源占用更多，需要投入更多的硬件资源。
- 需要购买数字证书，增加了成本。
- 数字证书需要绑定 IP，因此无法在一个 IP 上绑定多个域名。
